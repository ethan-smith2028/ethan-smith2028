<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Football Operator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    video {
      width: 70%;
      max-width: 700px;
      background: #000;
      border-radius: 8px;
      margin: 10px 0;
    }
    input, button {
      margin: 5px;
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
    }
    button {
      background: #28a;
      color: #fff;
      cursor: pointer;
    }
    button:hover { background: #159; }
    .color-picker { margin: 5px 0; }
  </style>
</head>
<body>
  <h2>Football Stream Operator</h2>
  <video id="localVideo" autoplay playsinline muted></video>

  <div id="setup">
    <input id="homeName" placeholder="Home Team" value="Home">
    <div class="color-picker">
      <label>Home Color:</label>
      <input type="color" id="homeColor" value="#0044cc">
    </div>
    <input id="awayName" placeholder="Away Team" value="Away">
    <div class="color-picker">
      <label>Away Color:</label>
      <input type="color" id="awayColor" value="#cc0000">
    </div>
    <button onclick="goLive()">Go Live</button>
  </div>

  <div id="controls" style="display:none;">
    <h3>Controls</h3>
    <div>
      <button onclick="score('home',7)">+7 Home</button>
      <button onclick="score('home',3)">+3 Home</button>
      <button onclick="score('home',2)">+2 Home</button>
      <button onclick="score('home',1)">+1 Home</button>
    </div>
    <div>
      <button onclick="score('away',7)">+7 Away</button>
      <button onclick="score('away',3)">+3 Away</button>
      <button onclick="score('away',2)">+2 Away</button>
      <button onclick="score('away',1)">+1 Away</button>
    </div>
    <div>
      <button onclick="nextQuarter()">Next Quarter</button>
      <button onclick="toggleClock()" id="clockBtn">Start Clock</button>
      <button onclick="throwFlag()">Throw Flag</button>
    </div>
    <p>Viewer link: <a href="viewer.html" target="_blank">Open Viewer</a></p>
  </div>

<script>
  const channel = new BroadcastChannel("football-game");
  let clockRunning = false, timer;

  let state = {
    home: "Home", away: "Away",
    homeColor: "#0044cc", awayColor: "#cc0000",
    score: {home:0, away:0},
    quarter: 1,
    clock: 15*60,
    flag: false
  };

  async function goLive(){
    const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    document.getElementById("localVideo").srcObject = stream;
    document.getElementById("setup").style.display = "none";
    document.getElementById("controls").style.display = "block";
    updateState(); // ðŸ”¥ send immediately
  }

  function updateState(){
    state.home = document.getElementById("homeName").value;
    state.away = document.getElementById("awayName").value;
    state.homeColor = document.getElementById("homeColor").value;
    state.awayColor = document.getElementById("awayColor").value;
    channel.postMessage(state);
  }

  // ðŸ”¥ Live updates on name/color changes
  document.getElementById("homeName").addEventListener("input", updateState);
  document.getElementById("awayName").addEventListener("input", updateState);
  document.getElementById("homeColor").addEventListener("input", updateState);
  document.getElementById("awayColor").addEventListener("input", updateState);

  function score(team, pts){ state.score[team]+=pts; updateState(); }
  function nextQuarter(){ state.quarter++; state.clock=15*60; updateState(); }

  function toggleClock(){
    if(clockRunning){
      clearInterval(timer);
      document.getElementById("clockBtn").textContent="Start Clock";
    } else {
      timer = setInterval(()=>{
        if(state.clock>0){ state.clock--; updateState(); }
      },1000);
      document.getElementById("clockBtn").textContent="Stop Clock";
    }
    clockRunning=!clockRunning;
  }

  function throwFlag(){
    state.flag = true;
    updateState();
    setTimeout(()=>{ state.flag=false; updateState(); },7000);
  }
</script>
</body>
</html>
