<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - Titan Tech</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CGT8KVV8YF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CGT8KVV8YF');
  </script>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />

  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f6f9;
      color: #333;
      padding: 20px;
      margin: 0;
    }
    header {
      background: #003366;
      color: white;
      padding: 25px 15px;
      text-align: center;
      font-size: 2.2em;
      font-weight: bold;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }
    .container {
      max-width: 1000px;
      margin: 30px auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
      color: #003366;
    }
    .cart-summary {
      background: #fafafa;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .cart-summary h3 {
      color: #1a73e8;
    }
    .cart-summary h4 {
      font-weight: bold;
    }
    .tally-box {
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      margin: 2rem auto;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: none;
    }
    footer {
      background: #003366;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 40px;
      border-radius: 10px;
    }
  </style>
</head>

<body>
<header>Checkout - Northmark</header>

<div class="container">
  <h2>Enter Your Information</h2>

  <div class="cart-summary">
    <h3>Cart Summary</h3>
    <div id="cart-items"></div>
    <h4>Total: $<span id="cart-total"></span></h4>
  </div>

  <form id="checkout-form">
    <input type="hidden" id="order_details" name="order_details">
    <input type="hidden" id="total_price" name="total_price">

    <div class="tally-box">
      <iframe id="tally-form" src="about:blank" title="Titan Tech Payment Form"></iframe>
    </div>
  </form>
</div>

<footer>
  &copy; 2025 Titan Tech. All rights reserved.
</footer>

<script>
  emailjs.init("31O7qMWoDFs0of_gr");

  document.addEventListener("DOMContentLoaded", function () {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const totalPrice = parseFloat(localStorage.getItem("totalPrice")) || 0;

    const cartItemsContainer = document.getElementById("cart-items");
    const cartTotalElement = document.getElementById("cart-total");

    if (cart.length > 0) {
        cart.forEach(item => {
            const sizeText = item.size ? ` (Size: ${item.size})` : "";
            let div = document.createElement("div");
            div.innerHTML = `<strong>${item.name}</strong>${sizeText} - $${item.price.toFixed(2)} x${item.quantity}`;
            cartItemsContainer.appendChild(div);
        });
        cartTotalElement.textContent = totalPrice.toFixed(2);
    } else {
        cartItemsContainer.innerHTML = "<p>Your cart is empty.</p>";
        cartTotalElement.textContent = "0.00";
    }

    // Set iframe src dynamically
    const tallyFrame = document.getElementById("tally-form");

// Modify the URL to pass the amount as a number
const tallyURL = `https://tally.so/embed/wggLRK?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1&amount=${totalPrice.toFixed(2)}`;
tallyFrame.src = tallyURL;

    // Log for debugging
    console.log("Tally Form URL with total amount:", tallyURL);

    // Fill hidden inputs for emailjs
    const orderDetails = cart.map(item => {
        const sizeText = item.size ? ` (Size: ${item.size})` : "";
        return `${item.name}${sizeText} x${item.quantity} ($${item.price.toFixed(2)})`;
    }).join(", ");
    
    document.getElementById("order_details").value = orderDetails;
    document.getElementById("total_price").value = `$${totalPrice.toFixed(2)}`;

    // Log hidden fields for debugging
    console.log("Order Details (hidden field):", document.getElementById("order_details").value);
    console.log("Total Price (hidden field):", document.getElementById("total_price").value);
});


</script>
</body>
</html>
