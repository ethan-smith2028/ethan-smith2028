<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player - Ethan Smith</title>
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/ZRtZB2Kb/ES-Final-2.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* -------------------------
   GENERAL PAGE STYLE
-------------------------- */
body {
    margin: 0;
    font-family: "Inter", sans-serif;
    background: #ffffff;
    color: #222;
}

/* -------------------------
   NAVIGATION BAR
-------------------------- */
.navbar {
    background: #111;
    color: white;
    padding: 15px 0;
}

.nav-container {
    width: 90%;
    margin: auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo a {
    color: #fff;
    text-decoration: none;
}

.nav-menu {
    list-style: none;
    display: flex;
    gap: 30px;
}

.nav-menu a {
    color: white;
    text-decoration: none;
    font-weight: 500;
}

/* -------------------------
   PROFILE HEADER
-------------------------- */
.profile-container {
    width: 90%;
    margin: 40px auto;
}

.profile-header {
    display: flex;
    gap: 30px;
    align-items: center;
}

.profile-header img {
    width: 220px;
    height: 220px;
    border-radius: 6px;
    object-fit: cover;
    border: 3px solid #e6e6e6;
}

.player-info h1 {
    margin: 0;
    font-size: 38px;
    font-weight: 700;
}

.player-info h2 {
    margin-top: 5px;
    color: #666;
    font-weight: 500;
}

.player-details {
    padding: 0;
    margin-top: 10px;
    list-style: none;
    line-height: 1.7em;
}

/* -------------------------
   STATS + PREVIOUS GAME LAYOUT
-------------------------- */
.stats-flex {
    display: flex;
    gap: 30px;
    align-items: flex-start;
    margin-top: 40px;
}

/* left column (season + career stats) */
.stats-column {
    flex: 1;
}

/* right column */
.previous-game {
    width: 350px;
    padding: 20px;
    border-radius: 6px;
    border-left: 5px solid rgb(241, 194, 50);
    background: #fff9e6;
    margin-top: 0;
}

/* -------------------------
   SECTION HEADERS
-------------------------- */
.stats-section h3,
.game-log h3,
.previous-game h4 {
    border-bottom: 2px solid #f1c232;
    padding-bottom: 5px;
    font-size: 22px;
    font-weight: 700;
    color: #222;
}

/* -------------------------
   TABLE STYLING
-------------------------- */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 15px;
}

th {
    background: #f8f8f8;
    font-weight: 700;
    color: #444;
    padding: 10px;
    border-bottom: 2px solid #ddd;
    text-align: center;
}

td {
    padding: 12px 10px;
    border-bottom: 1px solid #eee;
    text-align: center;
}

tr:hover {
    background: #fafafa;
}

/* -------------------------
   GAME LOG MATCHUP STYLE
-------------------------- */
.matchup {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.team {
    text-align: center;
}

.team-logo {
    width: 36px;
    height: 36px;
    margin-bottom: 3px;
}

.team-name {
    font-size: 12px;
}

/* -------------------------
   DOWNLOAD BUTTON
-------------------------- */
.download-btn {
    background: #f1c232;
    border: none;
    padding: 7px 15px;
    cursor: pointer;
    font-size: 14px;
    border-radius: 4px;
    font-weight: 600;
}

.download-btn:hover {
    background: #e0b020;
}

/* -------------------------
   RESPONSIVE
-------------------------- */
@media (max-width: 900px) {
    .stats-flex {
        flex-direction: column;
    }

    .previous-game {
        width: 100%;
        margin-top: 20px;
    }
}

@media (max-width: 800px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
    }
}
</style>

</head>

<body>

<!-- Google Tag Manager -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CGT8KVV8YF"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CGT8KVV8YF');
</script>

<div class="profile-container">

    <!-- PROFILE HEADER -->
    <div class="profile-header">
        <div class="profile-picture">
            <img src="pics/2024-11-23 Vancouver Rangers-110.jpg" alt="Player Image">
        </div>
        <div class="player-info">
            <h1>Ethan Smith</h1>
            <h2>#73 G</h2>
            <ul class="player-details">
                <li><strong>Height:</strong> 5'9"</li>
                <li><strong>Weight:</strong> 182 lb</li>
                <li><strong>Born:</strong> 12/21/2009 (Age: 15)</li>
                <li><strong>Birthplace:</strong> Columbus, OH</li>
                <li><strong>Catches:</strong> Left</li>
            </ul>
        </div>
    </div>

    <!-- STATS + PREVIOUS GAME SIDE BY SIDE -->
    <div class="stats-flex">

        <div class="stats-column">
            <div class="season-stats">
                <h3>2025-26 Season - Linsly/Nailers</h3>
                <table>
                    <tr>
                        <th>GP</th>
                        <th>W</th>
                        <th>L</th>
                        <th>GAA</th>
                        <th>SV%</th>
                    </tr>
                    <tr>
                        <td id="GamesPlayed-season"></td>
                        <td id="wins-season"></td>
                        <td id="loss-season"></td>
                        <td id="gaa"></td>
                        <td id="sv%"></td>
                    </tr>
                </table>
            </div>

            <div class="career-stats">
                <h3>Career</h3>
                <table>
                    <tr>
                        <th>GP</th>
                        <th>W</th>
                        <th>L</th>
                        <th>SO</th>
                        <th>GAA</th>
                        <th>SV%</th>
                    </tr>
                    <tr>
                        <td id="GamesPlayed"></td>
                        <td id="wins"></td>
                        <td id="loss"></td>
                        <td id="shutouts"></td>
                        <td id="gaa1"></td>
                        <td id="sv%1"></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="previous-game">
            <h4>Previous Game</h4>
            <div id="previousGameDetails"></div>
        </div>

    </div>

    <!-- GAME LOG -->
    <div class="game-section">
        <div class="game-log">
            <h3>Game Log</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Matchup</th>
                        <th>Decision</th>
                        <th>SA</th>
                        <th>GA</th>
                        <th>SV%</th>
                        <th>TOI</th>
                        <th>Scoresheet</th>
                    </tr>
                </thead>
                <tbody id="game-log-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDytzq8LrMWFsMw11nfu9xMjFxQTsepzUo",
    authDomain: "player-profile-5b21d.firebaseapp.com",
    projectId: "player-profile-5b21d",
    storageBucket: "player-profile-5b21d.firebasestorage.app",
    messagingSenderId: "881775282685",
    appId: "1:881775282685:web:2a1065ac9bef6414f17194",
    measurementId: "G-CVGPVES9DP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ðŸ”¥ Date formatting helper
  const formatDate = (isoDate) => {
    const date = new Date(isoDate);
    return date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric"
    });
  };

  document.addEventListener("DOMContentLoaded", async function () {

    const calculateSavePercentage = (shotsAgainst, goalsAgainst) => {
      return shotsAgainst > 0
        ? ((shotsAgainst - goalsAgainst) / shotsAgainst).toFixed(3)
        : "N/A";
    };

    const calculateGAA = (goalsAgainst, gamesPlayed) => {
      return gamesPlayed > 0
        ? (goalsAgainst / gamesPlayed).toFixed(2)
        : "N/A";
    };

    const updateStats = (seasonStats, careerStats) => {
      document.getElementById('GamesPlayed').innerText = careerStats.gamesPlayed;
      document.getElementById('wins').innerText = careerStats.wins;
      document.getElementById('loss').innerText = careerStats.losses;
      document.getElementById('shutouts').innerText = careerStats.shutouts;
      document.getElementById('gaa1').innerText = calculateGAA(careerStats.goalsAgainst, careerStats.gamesPlayed);
      document.getElementById('sv%1').innerText = calculateSavePercentage(careerStats.shotsAgainst, careerStats.goalsAgainst);

      document.getElementById('GamesPlayed-season').innerText = seasonStats.gamesPlayed;
      document.getElementById('wins-season').innerText = seasonStats.wins;
      document.getElementById('loss-season').innerText = seasonStats.losses;
      document.getElementById('gaa').innerText = calculateGAA(seasonStats.goalsAgainst, seasonStats.gamesPlayed);
      document.getElementById('sv%').innerText = calculateSavePercentage(seasonStats.shotsAgainst, seasonStats.goalsAgainst);
    };

    const baseCareerStats = {
      gamesPlayed: 27,
      wins: 17,
      losses: 10,
      shutouts: 3,
      shotsAgainst: 555,
      goalsAgainst: 54
    };

    async function loadGameLog() {
      try {
        const querySnapshot = await getDocs(collection(db, "games"));
        const games = [];

        querySnapshot.forEach((doc) => games.push(doc.data()));
        games.sort((a, b) => new Date(b.date) - new Date(a.date));

        const tableBody = document.getElementById('game-log-body');
        const previousGameContainer = document.getElementById('previousGameDetails');

        let seasonStats = { gamesPlayed: 0, wins: 0, losses: 0, shutouts: 0, shotsAgainst: 0, goalsAgainst: 0 };
        let careerStats = { ...baseCareerStats };

        // ====== Previous Game Box ======
        const latestGame = games[0];
        if (latestGame) {
          previousGameContainer.innerHTML = `
            <div class="matchup">
              <div class="team">
                <img src="${latestGame.awayTeam.logo}" alt="${latestGame.awayTeam.name}" class="team-logo">
                <p class="team-name">${latestGame.awayTeam.name}</p>
              </div>
              <div class="versus">VS</div>
              <div class="team">
                <img src="${latestGame.homeTeam.logo}" alt="${latestGame.homeTeam.name}" class="team-logo">
                <p class="team-name">${latestGame.homeTeam.name}</p>
              </div>
            </div>
            <p><strong>Date:</strong> ${formatDate(latestGame.date)}</p>
            <p><strong>Decision:</strong> ${latestGame.decision}</p>
            <p><strong>Shots Against:</strong> ${latestGame.shotsAgainst}</p>
            <p><strong>Goals Against:</strong> ${latestGame.goalsAgainst}</p>
            <p><strong>Save %:</strong> ${calculateSavePercentage(latestGame.shotsAgainst, latestGame.goalsAgainst)}</p>
            <p><strong>Minutes Played:</strong> ${latestGame.minutesPlayed}</p>
          `;

          const prevGameDiv = document.querySelector('.previous-game');
          if (latestGame.decision === "W") prevGameDiv.style.boxShadow = "0 0 20px rgb(241, 194, 50);)";
          if (latestGame.decision === "L") prevGameDiv.style.boxShadow = "0 0 20px rgb(241, 194, 50);";
        }

        // ====== Game Log Table ======
        games.forEach((game) => {
          const savePercentage = calculateSavePercentage(game.shotsAgainst, game.goalsAgainst);
          const row = document.createElement('tr');

          row.innerHTML = `
            <td>${formatDate(game.date)}</td>
            <td>
              <div class="matchup">
                <div class="team">
                  <img src="${game.awayTeam.logo}" alt="${game.awayTeam.name}" class="team-logo">
                  <p class="team-name">${game.awayTeam.name}</p>
                </div>
                <div class="versus">VS</div>
                <div class="team">
                  <img src="${game.homeTeam.logo}" alt="${game.homeTeam.name}" class="team-logo">
                  <p class="team-name">${game.homeTeam.name}</p>
                </div>
              </div>
            </td>
            <td>${game.decision}</td>
            <td>${game.shotsAgainst}</td>
            <td>${game.goalsAgainst}</td>
            <td>${savePercentage}</td>
            <td>${game.minutesPlayed}</td>
            <td>
                <button class="download-btn" data-game='${JSON.stringify(game)}'>Download</button>
            </td>
          `;

          tableBody.appendChild(row);

          seasonStats.gamesPlayed++;
          if (game.decision === "W") seasonStats.wins++;
          if (game.decision === "L") seasonStats.losses++;
          seasonStats.shotsAgainst += game.shotsAgainst;
          seasonStats.goalsAgainst += game.goalsAgainst;
        });

        // ====== Recalculate Career ======
        careerStats.gamesPlayed = baseCareerStats.gamesPlayed + seasonStats.gamesPlayed;
        careerStats.wins = baseCareerStats.wins + seasonStats.wins;
        careerStats.losses = baseCareerStats.losses + seasonStats.losses;
        careerStats.shutouts = baseCareerStats.shutouts + seasonStats.shutouts;
        careerStats.shotsAgainst = baseCareerStats.shotsAgainst + seasonStats.shotsAgainst;
        careerStats.goalsAgainst = baseCareerStats.goalsAgainst + seasonStats.goalsAgainst;

        updateStats(seasonStats, careerStats);

        // ====== DOWNLOAD SCORESHEET ======
        setTimeout(() => {
          document.querySelectorAll(".download-btn").forEach(btn => {
            btn.addEventListener("click", () => {
              const game = JSON.parse(btn.dataset.game);

             const text = 
`HOCKEY GOALIE PERFORMANCE SHEET
================================

Date: ${formatDate(game.date)}

Matchup (Team vs. Team):
${game.awayTeam.name} @ ${game.homeTeam.name}

Decision (W / L / OTL):
${game.decision}

--------------------------------------------

Shots Against:      ${game.shotsAgainst}
Goals Against:      ${game.goalsAgainst}
Save Percentage:    ${calculateSavePercentage(game.shotsAgainst, game.goalsAgainst)}
Minutes Played:     ${game.minutesPlayed}

--------------------------------------------

Scouting Notes:
____________________________________________
____________________________________________
____________________________________________
`;


              const blob = new Blob([text], { type: "text/plain" });
              const url = URL.createObjectURL(blob);

              const a = document.createElement("a");
              a.href = url;
              a.download = `scoresheet_${game.date}.txt`;
              a.click();

              URL.revokeObjectURL(url);
            });
          });
        }, 200);

      } catch (error) {
        console.error("Error loading games:", error);
      }
    }

    loadGameLog();
  });
</script>

</body>
</html>
