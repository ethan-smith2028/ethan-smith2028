<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<title>Photo List with Buy ID</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: #000; color: white; display: flex; flex-direction: column; height: 100vh; }
  .top-bar { display: flex; justify-content: flex-end; background: #111; padding: 10px 12px; gap: 10px; align-items: center; }
  .top-bar button { border: none; padding: 0.6rem 1rem; border-radius: 6px; font-weight: bold; cursor: pointer; color: #fff; background: #444; transition: 0.3s; }
  .top-bar button:hover { background: #666; }
  #buyIdBtn { background: linear-gradient(135deg,#ffd700,#ff9a00); color: #222; border: 2px solid #ff9a00; border-radius: 10px; font-weight: bold; box-shadow: 0 0 12px rgba(255,165,0,0.8),0 0 25px rgba(255,215,0,0.6); animation: pulseGold 1.8s infinite; }
  #buyIdBtn:hover { background: linear-gradient(135deg,#ffb300,#ff6a00); box-shadow: 0 0 20px rgba(255,140,0,0.9),0 0 40px rgba(255,215,0,0.8); transform: scale(1.05); }
  @keyframes pulseGold { 0%,100% { box-shadow: 0 0 12px rgba(255,165,0,0.7),0 0 25px rgba(255,215,0,0.5); } 50% { box-shadow: 0 0 20px rgba(255,165,0,1),0 0 40px rgba(255,215,0,0.8); } }
  .list-container { flex: 1; overflow-y: auto; padding: 1rem; background: #111; }
  .photo-item { margin-bottom: 2rem; text-align: center; }
  .photo-item img { max-width: 100%; border-radius: 12px; }
  .download-button { display: none; background: #f48126; color: white; text-align: center; padding: 0.6rem 1rem; border-radius: 8px; font-weight: bold; text-decoration: none; margin-top: 0.5rem; cursor: pointer; }
  .download-button.show { display: inline-block; }
  .download-button:hover { background: #c25e14; }
  .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 1000; justify-content: center; align-items: center; }
  .modal-content { background: #fff; padding: 2rem; border-radius: 16px; width: 400px; max-width: 90%; position: relative; text-align: center; color: #000; }
  .modal-close { position: absolute; top: 10px; right: 15px; font-size: 1.3rem; border: none; background: none; cursor: pointer; color: #444; }
  .modal-content input { display: block; width: 100%; margin: 0.5rem 0; padding: 0.6rem; border: 1px solid #ddd; border-radius: 6px; }
  .modal-content button.primary { background: #f48126; border: none; color: #fff; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 0.5rem; }
  .modal-content button.primary:hover { background: #c25e14; }
  .password-wrapper { position: relative; display: flex; align-items: center; margin-top: 0.5rem; }
  .password-wrapper input { width: 100%; padding-right: 2.5rem; }
  .password-wrapper .toggle-eye { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; }
  .password-wrapper .toggle-eye:hover { color: #000; }
  .password-rules { text-align:left; font-size:0.85rem; margin-top:0.5rem; list-style:none; padding:0; }
  .password-rules li { margin: 0.3rem 0; display: flex; align-items: center; gap: 0.4rem; color: #a33; }
  .password-rules li.valid { color: #2c7a2c; }
  .password-rules li i { width: 18px; text-align: center; }
</style>
</head>
<body>

<div class="top-bar">
  <button id="buyIdBtn" onclick="window.location.href='https://tally.so/r/w5RVOv'">💳 Buy ID</button>
  <button id="loginBtn"><i class="fas fa-user-lock"></i> Login</button>
  <button onclick="openSignupModal()"><i class="fas fa-user-plus"></i> Sign Up</button>
</div>

<div class="list-container" id="listContainer"></div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="loginModal.style.display='none'">✖</button>
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Email" autocomplete="off" />
    <div class="password-wrapper">
      <input type="password" id="password" placeholder="Password" autocomplete="off" />
      <i class="fas fa-eye toggle-eye" onclick="toggleVisibility('password', this)"></i>
    </div>
    <button class="primary" onclick="handleLogin()">Login</button>
    <p id="loginError"></p>
  </div>
</div>

<!-- Sign Up Modal -->
<div id="signupModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="signupModal.style.display='none'">✖</button>
    <h2>Sign Up</h2>
    <input type="email" id="signupEmail" placeholder="Email" autocomplete="off" />
    <input type="text" id="signupAuth" placeholder="Authentication (e.g. Student ID)" autocomplete="off" />
    <div class="password-wrapper">
      <input type="password" id="signupPassword" placeholder="Password" autocomplete="off" />
      <i class="fas fa-eye toggle-eye" onclick="toggleVisibility('signupPassword', this)"></i>
    </div>
    <div class="password-wrapper">
      <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" autocomplete="off" />
      <i class="fas fa-eye toggle-eye" onclick="toggleVisibility('signupConfirmPassword', this)"></i>
    </div>
    <ul class="password-rules">
      <li id="ruleLength"><i class="fas fa-times-circle rule-invalid"></i> At least 6 characters</li>
      <li id="ruleUnique"><i class="fas fa-times-circle rule-invalid"></i> At least 1 special character</li>
      <li id="ruleNumber"><i class="fas fa-times-circle rule-invalid"></i> At least 1 number</li>
    </ul>
    <button class="primary" onclick="handleSignup()">Sign Up</button>
    <p id="signupError"></p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDZjXZtfqEscgVBYOYDZS-vRwxBuXuVsbQ",
  authDomain: "email-list-83dfb.firebaseapp.com",
  projectId: "email-list-83dfb",
  storageBucket: "email-list-83dfb.appspot.com",
  messagingSenderId: "471452404510",
  appId: "1:471452404510:web:e91752174f6f0000c1570f"
};
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

let isLoggedIn=false;

/* Photo List */
const allImages = [
  "upload/1.jpg", "upload/2.jpg", "upload/3.jpg", "upload/4.jpg", "upload/5.jpg", 
  "upload/6.jpg", "upload/7.jpg", "upload/8.jpg", "upload/9.jpg", "upload/10.jpg",
  "upload/11.jpg", "upload/12.jpg", "upload/13.jpg", "upload/14.jpg", "upload/15.jpg", 
  "upload/16.jpg", "upload/17.jpg", "upload/18.jpg", "upload/19.jpg", "upload/20.jpg",
  "upload/21.jpg", "upload/22.jpg", "upload/23.jpg", "upload/24.jpg", "upload/25.jpg", 
  "upload/26.jpg", "upload/27.jpg", "upload/28.jpg", "upload/29.jpg", "upload/30.jpg",
  "upload/31.jpg", "upload/32.jpg", "upload/33.jpg", "upload/34.jpg", "upload/35.jpg", 
  "upload/36.jpg", "upload/37.jpg", "upload/38.jpg", "upload/39.jpg", "upload/40.jpg",
  "upload/41.jpg", "upload/42.jpg", "upload/43.jpg", "upload/44.jpg", "upload/45.jpg", 
  "upload/46.jpg", "upload/47.jpg", "upload/48.jpg", "upload/49.jpg", "upload/50.jpg",
  "upload/51.jpg", "upload/52.jpg", "upload/53.jpg", "upload/54.jpg", "upload/55.jpg", 
  "upload/56.jpg", "upload/57.jpg", "upload/58.jpg", "upload/59.jpg", "upload/60.jpg",
  "upload/61.jpg", "upload/62.jpg", "upload/63.jpg", "upload/64.jpg", "upload/65.jpg", 
  "upload/66.jpg", "upload/67.jpg", "upload/68.jpg", "upload/69.jpg", "upload/70.jpg",
  "upload/71.jpg", "upload/72.jpg", "upload/73.jpg", "upload/74.jpg", "upload/75.jpg", 
  "upload/76.jpg", "upload/77.jpg", "upload/78.jpg", "upload/79.jpg", "upload/80.jpg",
  "upload/81.jpg", "upload/82.jpg", "upload/83.jpg", "upload/84.jpg", "upload/85.jpg", 
  "upload/86.jpg", "upload/87.jpg", "upload/88.jpg", "upload/89.jpg", "upload/90.jpg",
  "upload/91.jpg", "upload/92.jpg", "upload/93.jpg", "upload/94.jpg", "upload/95.jpg", 
  "upload/96.jpg", "upload/97.jpg", "upload/98.jpg", "upload/99.jpg", "upload/100.jpg",
  "upload/101.jpg", "upload/102.jpg", "upload/103.jpg", "upload/104.jpg", "upload/105.jpg", 
  "upload/106.jpg", "upload/107.jpg", "upload/108.jpg", "upload/109.jpg", "upload/110.jpg",
  "upload/111.jpg", "upload/112.jpg", "upload/113.jpg", "upload/114.jpg", "upload/115.jpg", 
  "upload/116.jpg", "upload/117.jpg", "upload/118.jpg", "upload/119.jpg", "upload/120.jpg",
  "upload/121.jpg", "upload/122.jpg", "upload/123.jpg", "upload/124.jpg", "upload/125.jpg", 
  "upload/126.jpg", "upload/127.jpg", "upload/128.jpg", "upload/129.jpg", "upload/130.jpg",
  "upload/131.jpg", "upload/132.jpg", "upload/133.jpg", "upload/134.jpg", "upload/135.jpg", 
  "upload/136.jpg", "upload/137.jpg", "upload/138.jpg", "upload/139.jpg", "upload/140.jpg",
  "upload/141.jpg", "upload/142.jpg", "upload/143.jpg", "upload/144.jpg", "upload/145.jpg", 
  "upload/146.jpg", "upload/147.jpg", "upload/148.jpg", "upload/149.jpg", "upload/150.jpg",
  "upload/151.jpg", "upload/152.jpg", "upload/153.jpg", "upload/154.jpg", "upload/155.jpg", 
  "upload/156.jpg", "upload/157.jpg", "upload/158.jpg", "upload/159.jpg", "upload/160.jpg",
  "upload/161.jpg", "upload/162.jpg", "upload/163.jpg", "upload/164.jpg", "upload/165.jpg", 
  "upload/166.jpg", "upload/167.jpg", "upload/168.jpg", "upload/169.jpg", "upload/170.jpg",
  "upload/171.jpg", "upload/172.jpg", "upload/173.jpg", "upload/174.jpg", "upload/175.jpg", 
  "upload/176.jpg", "upload/177.jpg"
];
function buildList(){
  const container=document.getElementById("listContainer");
  allImages.forEach(src=>{
    const div=document.createElement("div");
    div.className="photo-item";
    const wrapper=document.createElement("div");
    wrapper.className="photo-wrapper";
    const img=document.createElement("img"); img.src=src;
    wrapper.appendChild(img);
    div.appendChild(wrapper);

    const btn=document.createElement("a");
    btn.href="#"; btn.className="download-button"; btn.innerHTML='<i class="fas fa-download"></i> Download';
    btn.onclick=e=>{
      e.preventDefault();
      if(!isLoggedIn) return;
      const a=document.createElement("a"); a.href=src; a.download=src.split("/").pop(); a.click();
    };
    div.appendChild(btn);
    container.appendChild(div);
  });
}
buildList();

/* Toggle visibility */
function toggleVisibility(id, el){
  const input=document.getElementById(id);
  input.type=input.type==="password"?"text":"password";
  el.classList.toggle("fa-eye"); el.classList.toggle("fa-eye-slash");
}
window.toggleVisibility=toggleVisibility;

/* Password rules live check */
document.getElementById("signupPassword")?.addEventListener("input",()=>{
  const val=document.getElementById("signupPassword").value;
  updateRule("ruleLength", val.length>=6);
  updateRule("ruleUnique", /[^A-Za-z0-9]/.test(val));
  updateRule("ruleNumber", /\d/.test(val));
});
function updateRule(id, valid){
  const el=document.getElementById(id); const icon=el.querySelector("i");
  icon.className=valid?"fas fa-check-circle rule-valid":"fas fa-times-circle rule-invalid";
}

/* Signup */
async function handleSignup(){
  const email=document.getElementById("signupEmail").value.trim();
  const auth=document.getElementById("signupAuth").value.trim();
  const pass=document.getElementById("signupPassword").value.trim();
  const pass2=document.getElementById("signupConfirmPassword").value.trim();
  const error=document.getElementById("signupError");

  if(!email||!auth||!pass){ error.textContent="All fields required."; return; }
  if(pass!==pass2){ error.textContent="Passwords do not match."; return; }
  if(pass.length<6||!/\d/.test(pass)||!/[^A-Za-z0-9]/.test(pass)){ error.textContent="Password does not meet requirements."; return; }

  try{
    const docRef=doc(db,"accounts",email);
    if((await getDoc(docRef)).exists()){ error.textContent="Email already exists"; return; }
    await setDoc(docRef,{ email, auth, password:pass, approvalStatus:"pending", createdAt:Date.now() });
    error.style.color="green"; error.textContent="Account created ✅ awaiting admin approval.";
  } catch(e){ console.error(e); error.textContent="Error creating account."; }
}
window.handleSignup=handleSignup;

/* Login */
async function handleLogin(){
  const u=document.getElementById("username").value.trim();
  const p=document.getElementById("password").value.trim();
  const err=document.getElementById("loginError");

  try{
    const docRef=doc(db,"accounts",u);
    const snap=await getDoc(docRef);
    if(!snap.exists()){ err.textContent="❌ Invalid email or password."; return; }
    const data=snap.data();
    if(data.password!==p){ err.textContent="❌ Invalid email or password."; return; }
    if(data.approvalStatus!=="approved"){ err.textContent="⚠️ Account not yet approved."; return; }
    isLoggedIn=true; document.getElementById("loginModal").style.display="none";
    document.getElementById("loginBtn").textContent="Logged In ✅";
    document.querySelectorAll(".download-button").forEach(b=>b.classList.add("show"));
  }catch(e){ console.error(e); err.textContent="⚠️ Login failed."; }
}
window.handleLogin=handleLogin;

/* Modals */
function openSignupModal(){ document.getElementById("signupModal").style.display="flex"; }
window.openSignupModal=openSignupModal;
document.getElementById("loginBtn").onclick=()=>document.getElementById("loginModal").style.display="flex";
</script>
</body>
</html>
