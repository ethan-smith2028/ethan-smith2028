<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<title>Photo List with Buy ID</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: #000; color: white; display: flex; flex-direction: column; height: 100vh; }
  .top-bar { display: flex; justify-content: flex-end; background: #111; padding: 10px 12px; gap: 10px; align-items: center; }
  .top-bar button { border: none; padding: 0.6rem 1rem; border-radius: 6px; font-weight: bold; cursor: pointer; color: #fff; background: #444; transition: 0.3s; }
  .top-bar button:hover { background: #666; }
  #buyIdBtn { background: linear-gradient(135deg,#ffd700,#ff9a00); color: #222; border: 2px solid #ff9a00; border-radius: 10px; font-weight: bold; box-shadow: 0 0 12px rgba(255,165,0,0.8),0 0 25px rgba(255,215,0,0.6); animation: pulseGold 1.8s infinite; }
  #buyIdBtn:hover { background: linear-gradient(135deg,#ffb300,#ff6a00); box-shadow: 0 0 20px rgba(255,140,0,0.9),0 0 40px rgba(255,215,0,0.8); transform: scale(1.05); }
  @keyframes pulseGold { 0%,100% { box-shadow: 0 0 12px rgba(255,165,0,0.7),0 0 25px rgba(255,215,0,0.5); } 50% { box-shadow: 0 0 20px rgba(255,165,0,1),0 0 40px rgba(255,215,0,0.8); } }
  .list-container { flex: 1; overflow-y: auto; padding: 1rem; background: #111; }
  .photo-item { margin-bottom: 2rem; text-align: center; }
  .photo-item img { max-width: 100%; border-radius: 12px; }
  .download-button { display: none; background: #f48126; color: white; text-align: center; padding: 0.6rem 1rem; border-radius: 8px; font-weight: bold; text-decoration: none; margin-top: 0.5rem; cursor: pointer; }
  .download-button.show { display: inline-block; }
  .download-button:hover { background: #c25e14; }
  .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 1000; justify-content: center; align-items: center; }
  .modal-content { background: #fff; padding: 2rem; border-radius: 16px; width: 400px; max-width: 90%; position: relative; text-align: center; color: #000; }
  .modal-close { position: absolute; top: 10px; right: 15px; font-size: 1.3rem; border: none; background: none; cursor: pointer; color: #444; }
  .modal-content input { display: block; width: 100%; margin: 0.5rem 0; padding: 0.6rem; border: 1px solid #ddd; border-radius: 6px; }
  .modal-content button.primary { background: #f48126; border: none; color: #fff; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 0.5rem; }
  .modal-content button.primary:hover { background: #c25e14; }
  .password-wrapper { position: relative; display: flex; align-items: center; margin-top: 0.5rem; }
  .password-wrapper input { width: 100%; padding-right: 2.5rem; }
  .password-wrapper .toggle-eye { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; }
  .password-wrapper .toggle-eye:hover { color: #000; }
  .password-rules { text-align:left; font-size:0.85rem; margin-top:0.5rem; list-style:none; padding:0; }
  .password-rules li { margin: 0.3rem 0; display: flex; align-items: center; gap: 0.4rem; color: #a33; }
  .password-rules li.valid { color: #2c7a2c; }
  .password-rules li i { width: 18px; text-align: center; }
</style>
</head>
<body>

<div class="top-bar">
  <button id="buyIdBtn" onclick="window.location.href='https://tally.so/r/w5RVOv'">💳 Buy ID</button>
  <button id="loginBtn"><i class="fas fa-user-lock"></i> Login</button>
  <button onclick="openSignupModal()"><i class="fas fa-user-plus"></i> Sign Up</button>
</div>

<div class="list-container" id="listContainer"></div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="loginModal.style.display='none'">✖</button>
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Email" autocomplete="off" />
    <div class="password-wrapper">
      <input type="password" id="password" placeholder="Password" autocomplete="off" />
      <i class="fas fa-eye toggle-eye" onclick="toggleVisibility('password', this)"></i>
    </div>
    <button class="primary" onclick="handleLogin()">Login</button>
    <p id="loginError"></p>
  </div>
</div>

<!-- Sign Up Modal -->
<div id="signupModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="signupModal.style.display='none'">✖</button>
    <h2>Sign Up</h2>
    <input type="email" id="signupEmail" placeholder="Email" autocomplete="off" />
    <input type="text" id="signupAuth" placeholder="Authentication (e.g. Student ID)" autocomplete="off" />
    <div class="password-wrapper">
      <input type="password" id="signupPassword" placeholder="Password" autocomplete="off" />
      <i class="fas fa-eye toggle-eye" onclick="toggleVisibility('signupPassword', this)"></i>
    </div>
    <div class="password-wrapper">
      <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" autocomplete="off" />
      <i class="fas fa-eye toggle-eye" onclick="toggleVisibility('signupConfirmPassword', this)"></i>
    </div>
    <ul class="password-rules">
      <li id="ruleLength"><i class="fas fa-times-circle rule-invalid"></i> At least 6 characters</li>
      <li id="ruleUnique"><i class="fas fa-times-circle rule-invalid"></i> At least 1 special character</li>
      <li id="ruleNumber"><i class="fas fa-times-circle rule-invalid"></i> At least 1 number</li>
    </ul>
    <button class="primary" onclick="handleSignup()">Sign Up</button>
    <p id="signupError"></p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDZjXZtfqEscgVBYOYDZS-vRwxBuXuVsbQ",
  authDomain: "email-list-83dfb.firebaseapp.com",
  projectId: "email-list-83dfb",
  storageBucket: "email-list-83dfb.appspot.com",
  messagingSenderId: "471452404510",
  appId: "1:471452404510:web:e91752174f6f0000c1570f"
};
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

let isLoggedIn=false;

/* Photo List */
const allImages = ["upload/1.JPG", "upload/2.JPG", "upload/3.JPG", "upload/4.JPG", "upload/5.JPG", "upload/6.JPG", "upload/7.JPG", "upload/8.JPG", "upload/9.JPG", "upload/10.JPG", "upload/11.JPG", "upload/12.JPG", "upload/13.JPG", "upload/14.JPG", "upload/15.JPG", "upload/16.JPG", "upload/17.JPG", "upload/18.JPG", "upload/19.JPG", "upload/20.JPG", "upload/21.JPG", "upload/22.JPG", "upload/23.JPG", "upload/24.JPG", "upload/25.JPG", "upload/26.JPG", "upload/27.JPG", "upload/28.JPG", "upload/29.JPG", "upload/30.JPG", "upload/31.JPG", "upload/32.JPG", "upload/33.JPG", "upload/34.JPG", "upload/35.JPG", "upload/36.JPG", "upload/37.JPG", "upload/38.JPG", "upload/39.JPG", "upload/40.JPG", "upload/41.JPG", "upload/42.JPG", "upload/43.JPG", "upload/44.JPG", "upload/45.JPG", "upload/46.JPG", "upload/47.JPG", "upload/48.JPG", "upload/49.JPG", "upload/50.JPG", "upload/51.JPG", "upload/52.JPG", "upload/53.JPG", "upload/54.JPG", "upload/55.JPG", "upload/56.JPG", "upload/57.JPG", "upload/58.JPG", "upload/59.JPG", "upload/60.JPG", "upload/61.JPG", "upload/62.JPG", "upload/63.JPG", "upload/64.JPG", "upload/65.JPG", "upload/66.JPG", "upload/67.JPG", "upload/68.JPG", "upload/69.JPG", "upload/70.JPG", "upload/71.JPG", "upload/72.JPG", "upload/73.JPG", "upload/74.JPG", "upload/75.JPG", "upload/76.JPG", "upload/77.JPG", "upload/78.JPG", "upload/79.JPG", "upload/80.JPG", "upload/81.JPG", "upload/82.JPG", "upload/83.JPG", "upload/84.JPG", "upload/85.JPG", "upload/86.JPG", "upload/87.JPG", "upload/88.JPG", "upload/89.JPG", "upload/90.JPG", "upload/91.JPG", "upload/92.JPG", "upload/93.JPG", "upload/94.JPG", "upload/95.JPG", "upload/96.JPG", "upload/97.JPG", "upload/98.JPG", "upload/99.JPG", "upload/100.JPG", "upload/101.JPG", "upload/102.JPG", "upload/103.JPG", "upload/104.JPG", "upload/105.JPG", "upload/106.JPG", "upload/107.JPG", "upload/108.JPG", "upload/109.JPG", "upload/110.JPG", "upload/111.JPG", "upload/112.JPG", "upload/113.JPG", "upload/114.JPG", "upload/115.JPG", "upload/116.JPG", "upload/117.JPG", "upload/118.JPG", "upload/119.JPG", "upload/120.JPG", "upload/121.JPG", "upload/122.JPG", "upload/123.JPG", "upload/124.JPG", "upload/125.JPG", "upload/126.JPG", "upload/127.JPG", "upload/128.JPG", "upload/129.JPG", "upload/130.JPG", "upload/131.JPG", "upload/132.JPG", "upload/133.JPG", "upload/134.JPG", "upload/135.JPG", "upload/136.JPG", "upload/137.JPG", "upload/138.JPG", "upload/139.JPG", "upload/140.JPG", "upload/141.JPG", "upload/142.JPG", "upload/143.JPG", "upload/144.JPG", "upload/145.JPG", "upload/146.JPG", "upload/147.JPG", "upload/148.JPG", "upload/149.JPG", "upload/150.JPG", "upload/151.JPG", "upload/152.JPG", "upload/153.JPG", "upload/154.JPG", "upload/155.JPG", "upload/156.JPG", "upload/157.JPG", "upload/158.JPG", "upload/159.JPG", "upload/160.JPG", "upload/161.JPG", "upload/162.JPG", "upload/163.JPG", "upload/164.JPG", "upload/165.JPG", "upload/166.JPG"];
function buildList(){
  const container=document.getElementById("listContainer");
  images.forEach(src=>{
    const div=document.createElement("div");
    div.className="photo-item";
    const wrapper=document.createElement("div");
    wrapper.className="photo-wrapper";
    const img=document.createElement("img"); img.src=src;
    wrapper.appendChild(img);
    div.appendChild(wrapper);

    const btn=document.createElement("a");
    btn.href="#"; btn.className="download-button"; btn.innerHTML='<i class="fas fa-download"></i> Download';
    btn.onclick=e=>{
      e.preventDefault();
      if(!isLoggedIn) return;
      const a=document.createElement("a"); a.href=src; a.download=src.split("/").pop(); a.click();
    };
    div.appendChild(btn);
    container.appendChild(div);
  });
}
buildList();

/* Toggle visibility */
function toggleVisibility(id, el){
  const input=document.getElementById(id);
  input.type=input.type==="password"?"text":"password";
  el.classList.toggle("fa-eye"); el.classList.toggle("fa-eye-slash");
}
window.toggleVisibility=toggleVisibility;

/* Password rules live check */
document.getElementById("signupPassword")?.addEventListener("input",()=>{
  const val=document.getElementById("signupPassword").value;
  updateRule("ruleLength", val.length>=6);
  updateRule("ruleUnique", /[^A-Za-z0-9]/.test(val));
  updateRule("ruleNumber", /\d/.test(val));
});
function updateRule(id, valid){
  const el=document.getElementById(id); const icon=el.querySelector("i");
  icon.className=valid?"fas fa-check-circle rule-valid":"fas fa-times-circle rule-invalid";
}

/* Signup */
async function handleSignup(){
  const email=document.getElementById("signupEmail").value.trim();
  const auth=document.getElementById("signupAuth").value.trim();
  const pass=document.getElementById("signupPassword").value.trim();
  const pass2=document.getElementById("signupConfirmPassword").value.trim();
  const error=document.getElementById("signupError");

  if(!email||!auth||!pass){ error.textContent="All fields required."; return; }
  if(pass!==pass2){ error.textContent="Passwords do not match."; return; }
  if(pass.length<6||!/\d/.test(pass)||!/[^A-Za-z0-9]/.test(pass)){ error.textContent="Password does not meet requirements."; return; }

  try{
    const docRef=doc(db,"accounts",email);
    if((await getDoc(docRef)).exists()){ error.textContent="Email already exists"; return; }
    await setDoc(docRef,{ email, auth, password:pass, approvalStatus:"pending", createdAt:Date.now() });
    error.style.color="green"; error.textContent="Account created ✅ awaiting admin approval.";
  } catch(e){ console.error(e); error.textContent="Error creating account."; }
}
window.handleSignup=handleSignup;

/* Login */
async function handleLogin(){
  const u=document.getElementById("username").value.trim();
  const p=document.getElementById("password").value.trim();
  const err=document.getElementById("loginError");

  try{
    const docRef=doc(db,"accounts",u);
    const snap=await getDoc(docRef);
    if(!snap.exists()){ err.textContent="❌ Invalid email or password."; return; }
    const data=snap.data();
    if(data.password!==p){ err.textContent="❌ Invalid email or password."; return; }
    if(data.approvalStatus!=="approved"){ err.textContent="⚠️ Account not yet approved."; return; }
    isLoggedIn=true; document.getElementById("loginModal").style.display="none";
    document.getElementById("loginBtn").textContent="Logged In ✅";
    document.querySelectorAll(".download-button").forEach(b=>b.classList.add("show"));
  }catch(e){ console.error(e); err.textContent="⚠️ Login failed."; }
}
window.handleLogin=handleLogin;

/* Modals */
function openSignupModal(){ document.getElementById("signupModal").style.display="flex"; }
window.openSignupModal=openSignupModal;
document.getElementById("loginBtn").onclick=()=>document.getElementById("loginModal").style.display="flex";
</script>
</body>
</html>
